<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="The blog of Christopher Martinez, a software developer from Fresno."><title>Opinion: VCS Commits</title><link rel=canonical href=https://chrsm.org/2022/02/28/opinion-vcs-commits/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{margin:50px 0 0}#links :nth-child(2){float:right}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}:root{--darkreader-neutral-background:#181a1b;--darkreader-neutral-text:#e8e6e3;--darkreader-selection-background:#004daa;--darkreader-selection-text:#e8e6e3}html{background-color:#181a1b!important}html,body,input,textarea,select,button{background-color:#181a1b}html,body,input,textarea,select,button{border-color:#736b5e;color:#e8e6e3}a{color:#3391ff}table{border-color:#545b5e}::placeholder{color:#b2aba1}input:-webkit-autofill,textarea:-webkit-autofill,select:-webkit-autofill{background-color:#555b00!important;color:#e8e6e3!important}::-webkit-scrollbar{background-color:#202324;color:#aba499}::-webkit-scrollbar-thumb{background-color:#454a4d}::-webkit-scrollbar-thumb:hover{background-color:#575e62}::-webkit-scrollbar-thumb:active{background-color:#484e51}::-webkit-scrollbar-corner{background-color:#181a1b}*{scrollbar-color:#202324 #454a4d}::selection{background-color:#004daa!important;color:#e8e6e3!important}::-moz-selection{background-color:#004daa!important;color:#e8e6e3!important}</style></head><body><section id=nav><h1><a href=https://chrsm.org/></a></h1><ul><li><a href=https://chrsm.org/>~/</a></li><li><a href=https://chrsm.org/about>~/about</a></li><li><a href=https://github.com/chrsm>~/github</a></li></ul></section><section id=content><h1>Opinion: VCS Commits</h1><div id=sub-header>February 2022 · 4 minute read</div><div class=entry-content><h2 id=preface>Preface</h2><p>I have some strongly-held beliefs about commit messages in VCS. For obvious
reasons, I tend to use git - but I believe that the core ideas extend to any
VCS and are not specific <em>to</em> git.</p><p>That being said, I can&rsquo;t say that I always follow this guide - like any other
human, I am prone to mistakes, and some things don&rsquo;t warrant such care.</p><p>Bad examples of commit messages, ahead of time, for transparency:</p><ul><li><a href=https://github.com/chrsm/dubya/commit/e2f9f92304eb30e2b91e5940fd856e3bd358e7a5>oops</a></li><li><a href=https://github.com/chrsm/dubya/commit/0cbc2eb46911b29c1e5363816ff316d385f19a81>&mldr; lol</a></li><li><a href=https://github.com/chrsm/dotfiles/commit/f7218ca7fb3039f1d030346a36b4eca7b84f1a42>updated vimrc</a></li><li>&ldquo;i need to remember things&rdquo; instead of actually writing something
useful</li></ul><p>I know that there are more bad examples, but first let me share what I think
looks <em>good</em>.</p><h2 id=commit-message-style>Commit Message Style</h2><p>For commit style, I like to follow a similar style to the
<a href=https://www.kernel.org/doc/html/v4.12/process/submitting-patches.html#describe-your-changes>Linux Kernel guidelines</a>; not strictly, but close to it. My preference
looks like the following:</p><pre tabindex=0><code>feature or affected pkgs: one-line general description, 80 chars max

Details about what you did and why, rationale behind the changes. If the line
would flow past 80 chars, newline and continue.

If there are multiple things addressed in a single commit, separate with
paragraphs to explain them individually.

refs, fixes or closes [reference to ticket]
</code></pre><p>A real-world example of this in the <a href=https://github.com/golang/go/commit/f9285818b6890b896f43a38449e35744d97c817a>go repo</a>:</p><pre tabindex=0><code>go/types, types2: fix string to type parameter conversions

Converting an untyped constant to a type parameter results
in a non-constant value; but the constant must still be
representable by all specific types of the type parameter.

Adjust the special handling for constant-to-type parameter
conversions to also include string-to-[]byte and []rune
conversions, which are handled separately for conversions
to types that are not type parameters because those are not
constant conversions in non-generic code.

Fixes #51386.
</code></pre><h3 id=rebase-guidelines>Rebase Guidelines</h3><p>Git history is important is pretty important to me. I want to know, at a
glance, what was worked on and the general description.</p><p>If I use git log or jump into more detailed history (<code>tig</code>), for nontrivial
commits, I should see some rationale or details that should give me enough info
to understand the problem.</p><p>There are several real-world examples of what I disagree with, but I don&rsquo;t want
to call anyone out - and I imagine that you&rsquo;ve seen things similar to the
following:</p><ul><li><code>fix typo</code> - where? why is this a distinct commit?</li><li><code>oops</code> - what was wrong?</li><li><code>add test</code> - for what?</li><li><code>update</code> - what was updated and why?</li><li><code>fixes #001</code> - what exactly was 001? Tickets can be edited or simply not have
decent details in the first place</li><li><code>address review comments</code> - why is this a distinct commit?</li><li><code>rebase</code>, <code>merge</code> - conflicts, what happened?</li><li><code>lint fixes</code> - update the offending commit!</li></ul><p>Something to note here, however, is that some level of this is acceptable
during development. Commit early, commit often. That being said, cleanup is a
constant process - you don&rsquo;t clean up your home once a month, clean up messes
as you go.</p><p>Once this makes it to the master branch, it&rsquo;s frozen - unless you rewrite
history, which I strongly discourage and would frown at.</p><h3 id=how-to-rebase-effectively>How to Rebase effectively</h3><p>Git rebase is very simple to take advantage of and offers a lot of ways to make
commit history grokable. This should be done prior to merging into the master
branch.</p><p>A workflow could look something like this:</p><ul><li>initial commit</li><li>added something</li><li>forgot to add something, so committed it</li><li>test</li><li>update test</li><li>oops messed up test</li></ul><p>To fix this up, we’ll use <code>git rebase</code>, specifically in interactive mode, which
is super easy to deal with.</p><p>Subsequently, getting a good history:</p><pre tabindex=0><code>$ git rebase -i HEAD~6
$ &lt; editor opens &gt;
</code></pre><p>You’ll see something like the following:</p><p><img src=https://chrsm.org/img/rebase_1.png alt=Untitled></p><p>Here, we want to:</p><ul><li>group <code>03cf5a9</code> and <code>437ae11</code></li><li>group <code>53ae95e...79ac780</code> - these are all test related and initial work,
might as well</li></ul><p>Using the nice commands, we use:</p><p><img src=https://chrsm.org/img/rebase_2.png alt=Untitled></p><p>We choose:</p><ul><li><code>reword</code> on <code>03cf5a9</code> - we’re merging the next commit; update the commit
message to mention file 2</li><li><code>fixup</code> on <code>43a7e11</code></li><li><code>reword</code> on <code>53ae95e</code> - we’re merging the next commit; update the commit
message to add the proper prefix</li><li><code>fixup</code> on the last two</li></ul><p>The resulting history is cleaner in branch <a href=https://github.com/chrsm/rebaseexample/commits/ex/rebase>ex/rebase</a> than in <a href=https://github.com/chrsm/rebaseexample/commits/master>master</a>.</p><p>Another really nice thing about rebase is the ability to re-order commits. In
this example, if we had added a commit later to add a new file:</p><p><img src=https://chrsm.org/img/rebase_3.png alt=Untitled></p><p>We can now choose to move this <code>add 4 file</code> commit to the relevant section and
merge it into the previous commits:</p><p><img src=https://chrsm.org/img/rebase_4.png alt=Untitled></p><p>We moved <code>4fd1aab</code> above the tests so that it’s grouped with others and chose to
merge it with those - preventing a “random” <code>example:</code> commit later on
<a href=https://github.com/golang/go/commit/f9285818b6890b896f43a38449e35744d97c817a>ex/rebaseorder</a>.</p><p>This isn’t always necessary, mind you. Let’s imagine for a moment that this is
a significant commit and we don’t want to merge it with the other examples.
In this case, simply reordering it is fine as in <a href=https://github.com/chrsm/rebaseexample/commits/ex/rebaseorder2>ex/rebaseorder2</a>.</p><p><img src=https://chrsm.org/img/rebase_5.png alt=Untitled></p><p>Leaving it there would be acceptable.</p><h3 id=references>References</h3><ul><li><a href=https://github.com/chrsm/dubya/commit/e2f9f92304eb30e2b91e5940fd856e3bd358e7a5>1</a> <a href=https://www.kernel.org/doc/html/v4.12/process/submitting-patches.html#describe-your-changes>Linux Kernel Commit Style</a></li><li><a href=https://github.com/chrsm/dubya/commit/0cbc2eb46911b29c1e5363816ff316d385f19a81>2</a> <a href=https://github.com/chrsm/rebaseexample/commits/master>Example repository with commits</a></li><li><a href=https://github.com/chrsm/dotfiles/commit/f7218ca7fb3039f1d030346a36b4eca7b84f1a42>3</a> <a href=https://github.com/chrsm/rebaseexample/commits/ex/rebase>Example rebased set of commits</a></li><li><a href=https://www.kernel.org/doc/html/v4.12/process/submitting-patches.html#describe-your-changes>4</a> <a href=https://github.com/chrsm/rebaseexample/commits/ex/rebaseorder>Example of rebased + reordered commits</a></li></ul></div><div id=links><a class="basic-alignment left" href=https://chrsm.org/2021/08/06/experimenting-w/gamedev-part-4-behavior-system/>&#171; Experimenting w/gamedev: Part 4 - Behavior System</a>
<a class="basic-alignment left" href=https://chrsm.org/2022/04/30/neovim-refactored-config/>neovim: refactored config &#187;</a></div></section></body></html>