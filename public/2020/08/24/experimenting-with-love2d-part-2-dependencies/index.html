<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="The blog of Christopher Martinez, a software developer from Fresno."><title>Experimenting with LOVE2D: Part 2 (Dependencies)</title><link rel=canonical href=https://chrsm.org/2020/08/24/experimenting-with-love2d-part-2-dependencies/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{margin:50px 0 0}#links :nth-child(2){float:right}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}:root{--darkreader-neutral-background:#181a1b;--darkreader-neutral-text:#e8e6e3;--darkreader-selection-background:#004daa;--darkreader-selection-text:#e8e6e3}html{background-color:#181a1b!important}html,body,input,textarea,select,button{background-color:#181a1b}html,body,input,textarea,select,button{border-color:#736b5e;color:#e8e6e3}a{color:#3391ff}table{border-color:#545b5e}::placeholder{color:#b2aba1}input:-webkit-autofill,textarea:-webkit-autofill,select:-webkit-autofill{background-color:#555b00!important;color:#e8e6e3!important}::-webkit-scrollbar{background-color:#202324;color:#aba499}::-webkit-scrollbar-thumb{background-color:#454a4d}::-webkit-scrollbar-thumb:hover{background-color:#575e62}::-webkit-scrollbar-thumb:active{background-color:#484e51}::-webkit-scrollbar-corner{background-color:#181a1b}*{scrollbar-color:#202324 #454a4d}::selection{background-color:#004daa!important;color:#e8e6e3!important}::-moz-selection{background-color:#004daa!important;color:#e8e6e3!important}</style></head><body><section id=nav><h1><a href=https://chrsm.org/></a></h1><ul><li><a href=https://chrsm.org/>~/</a></li><li><a href=https://chrsm.org/about>~/about</a></li><li><a href=https://github.com/chrsm>~/github</a></li></ul></section><section id=content><h1>Experimenting with LOVE2D: Part 2 (Dependencies)</h1><div id=sub-header>August 2020 Â· 3 minute read</div><div class=entry-content><p>Earlier this month, I started experimenting with LOVE2D and how I&rsquo;d develop a
game. There&rsquo;s a lot to take in and I&rsquo;m really still learning the basics in
the spare time that I have.</p><p>One of the things that I&rsquo;m not a big fan of is that Lua doesn&rsquo;t have a standard
package manager - there&rsquo;s Luarocks, but very few LOVE-related packages actually
have a rockspec. I&rsquo;m still working out how to include Luarocks packages properly
within LOVE. I found <a href=https://github.com/Alloyed/loverocks>loverocks</a> and will look into it very soon.</p><p>Given that I use git, it follows that I could just use git submodules, but my
experience with them has been frustrating - and not everything I want to use
is actually in git. I want to bundle certain things that aren&rsquo;t source code.
git submodules don&rsquo;t help in this regard.</p><p>What I really needed was a &ldquo;generic dependency manager&rdquo;. I searched for a while,
and found something that seemed like exactly what I wanted: <a href=https://github.com/buildinspace/peru>peru</a>.</p><h3 id=enter-peru>Enter&mldr; peru</h3><p><a href=https://github.com/buildinspace/peru>peru</a> is a dependency manager that can handle git, svn, hg, raw downloads -
pretty much anything you need. It can be further extended by custom plugins,
but I haven&rsquo;t yet had to implement one.</p><p>Peru allows pinning to certain revisions or tags, effectively helping push
to reproducible builds. It can also update dependencies automatically for you
with the <code>reup</code> command.</p><p>One thing that made me <em>extremely</em> happy is how configurable <code>peru.yaml</code> is.</p><p>For example, I have some <code>.so</code> and <code>.dll</code> files I want to move into a specific
directory. With peru, I can do this easily:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imports</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># specific to amd64 nix</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lib_64_so</span>: <span style=color:#ae81ff>./</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>curl module lib_64_so</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://server.org/release/lib-amd64.tar.gz</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>unpack</span>: <span style=color:#ae81ff>tar</span>
</span></span></code></pre></div><p><code>lib-amd64.tar.gz</code> includes a README, as well as a LICENSE file. I don&rsquo;t need
the README - but I do need the license. I also don&rsquo;t want to clobber my own
README with this download - or any other dependency. Peru allows this to solve
me - easily.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>curl module lib_64_so</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://server.org/release/lib-amd64.tar.gz</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>unpack</span>: <span style=color:#ae81ff>tar</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>drop</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>README</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>move</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>lib64.so</span>: <span style=color:#ae81ff>dest/lib64.so</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>LICENSE</span>: <span style=color:#ae81ff>vendor/libso_64.LICENSE</span>
</span></span></code></pre></div><p>Now I can easily track the license file - in case the project ever goes out -
and move the <code>.so</code> directly where I need it.</p><p>For curl-based dependencies, you can also specify a hash via the <code>sha1</code> field:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>curl ...</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>sha1</span>: <span style=color:#ae81ff>the-hash-i-trust</span>
</span></span></code></pre></div><p>Helps me reconcile downloading dependencies that may change - I <em>know</em> the last
version I knew worked (or trusted).</p><h3 id=git-too>git, too!</h3><p>Peru is really easy to use with git-based dependencies, too, with none of the
git submodule business (directly). Just like curl modules, I can drop some
of the files I don&rsquo;t actually want.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imports</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lualib</span>: <span style=color:#ae81ff>./</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>git module lualib</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://server.org/lualib</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>drop</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>README.md</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>main.lua</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>move</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>lib.lua</span>: <span style=color:#ae81ff>src/thirdparty/lib.lua</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>LICENSE</span>: <span style=color:#ae81ff>vendor/lib_lua.LICENSE</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>git-hash</span>
</span></span></code></pre></div><h3 id=recursive>Recursive!</h3><p>If one of your targets actually has a <code>peru.yaml</code> file, you can recursively
download that target&rsquo;s dependencies, too!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>git module lualib_recursive</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://server.org/lualib_recursive</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>recursive</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>If you only need a specific dependency of a dependency, you can skip <code>recursive</code>
and reference it in your own <code>imports</code> section, eg:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imports</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>dependency.sub_dependency</span>: <span style=color:#ae81ff>./target</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>... <span style=color:#ae81ff>definition of dependency ...</span>
</span></span></code></pre></div><h3 id=jj-zz>jj ZZ</h3><p>Since I started learning some game dev things, I&rsquo;ve been treating it like any
standard software project: tests, build scripts, CI, dependency management,
asset management&mldr;</p><p>It has definitely been a distraction, and I know that real game development
companies have their own tooling for stuff like this - but I&rsquo;m glad I was able
to find something simple that does exactly what I need without being overly
complicated.</p></div><div id=links><a class="basic-alignment left" href=https://chrsm.org/2020/08/05/experimenting-with-love2d-part-1/>&#171; Experimenting with LOVE2D: Part 1</a>
<a class="basic-alignment left" href=https://chrsm.org/2021/07/25/experimenting-w/building-a-game-part-3-lfs-maps/>Experimenting w/building a game: Part 3 - LFS, Maps &#187;</a></div></section></body></html>